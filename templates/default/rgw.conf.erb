LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" \"%{Host}i\"" proxy_combined
LogFormat "%{X-Forwarded-For}i %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" \"%{Host}i\"" proxy_debug

<VirtualHost <%= node['ceph']['radosgw']['rgw_addr'] %>>
  ServerName <%= @params[:server_name] %>
<% if node['ceph']['radosgw']['api_aliases'] -%>
<%   node['ceph']['radosgw']['api_aliases'].each do |api_alias| -%>
  ServerAlias <%= api_alias %>
<%   end -%>
<% end -%>
  ServerAdmin <%= node["ceph"]["radosgw"]["admin_email"] %>
  DocumentRoot <%= node['ceph']['radosgw']['path'] %>

  RewriteEngine On
  RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]

  SetEnv proxy-nokeepalive 1

  ProxyPass / unix:///var/run/ceph/radosgw.<%= node['ceph']['radosgw']['clientname'] %>|fcgi://localhost:9000/

  ErrorLog /var/log/<%= node['apache']['package'] %>/error.log
  CustomLog /var/log/<%= node['apache']['package'] %>/rgw-access.log proxy_combined
  ServerSignature Off
</VirtualHost>
